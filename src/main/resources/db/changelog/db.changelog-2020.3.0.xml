<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog logicalFilePath="db.changelog-master.xml" xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="2020-07-19-create_categories_table" author="matthias.weinert">
        <createTable tableName="CATEGORIES">
            <column name="ID" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATION_DATE" type="timestamp">
                <constraints nullable="false" />
            </column>
            <column name="DELETION_DATE" type="timestamp">
                <constraints nullable="true" />
            </column>
            <column name="NAME" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="ICON_ID" type="bigint">
                <constraints nullable="true" foreignKeyName="FK_CATEGORY_BINARY_DATA_ICON" references="BINARY_DATA(ID)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2020-07-19-create_cashaccount_transaction_table" author="matthias.weinert">
        <createTable tableName="CASH_ACCOUNT_TRANSACTIONS">
            <column name="ID" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATION_DATE" type="timestamp">
                <constraints nullable="false" />
            </column>
            <column name="DELETION_DATE" type="timestamp">
                <constraints nullable="true" />
            </column>
            <column name="CASH_ACCOUNT_ID" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_CASH_ACCOUNT_TRANSACTION_CASHACCOUNT" references="CASH_ACCOUNTS(ID)"/>
            </column>
            <column name="REFERENCE_BANK_ID" type="bigint">
                <constraints nullable="true" foreignKeyName="FK_CASH_ACCOUNT_TRANSACTION_BANK" references="BANKS(ID)"/>
            </column>
            <column name="CATEGORY_ID" type="bigint">
                <constraints nullable="true" foreignKeyName="FK_CASH_ACCOUNT_TRANSACTION_CATEGORY" references="CATEGORIES(ID)"/>
            </column>
            <column name="USAGE" type="varchar(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="varchar(1000)">
                <constraints nullable="true"/>
            </column>
            <column name="VALUTA_DATE" type="date">
                <constraints nullable="false" />
            </column>
            <column name="VALUE" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="REFERENCE" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="CREDITOR_IDENTIFIER" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="MANDATE" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="SALDO_BEFORE" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="SALDO_AFTER" type="double">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2020-07-19-category_name_unique" author="matthias.weinert">
        <addUniqueConstraint tableName="CATEGORIES" columnNames="NAME" />
    </changeSet>

    <changeSet id="2020-08-08-drop_bank_reference" author="matthias.weinert">
        <dropForeignKeyConstraint baseTableName="CASH_ACCOUNT_TRANSACTIONS" constraintName="FK_CASH_ACCOUNT_TRANSACTION_BANK" />
        <dropColumn tableName="CASH_ACCOUNT_TRANSACTIONS" columnName="REFERENCE_BANK_ID" />
    </changeSet>

    <changeSet id="2020-08-08-add_bank_reference_and_iban" author="matthias.weinert">
        <addColumn tableName="CASH_ACCOUNT_TRANSACTIONS">
            <column name="REFERENCE_BANK" type="varchar(255)" />
            <column name="REFERENCE_IBAN" type="varchar(50)" />
        </addColumn>
    </changeSet>

</databaseChangeLog>